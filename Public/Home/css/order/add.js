;/*!/lib/prototype/function.bind.js*/
define("order:lib/prototype/function.bind",function(){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var o=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){var r=this instanceof i?this:t||this,e=o.concat(Array.prototype.slice.call(arguments));return n.apply(r,e)};return i.prototype=this.prototype,r.prototype=new i,r})});
;/*!/lib/eventEmitter/eventEmitter.js*/
define("order:lib/eventEmitter/eventEmitter",function(t,e,n){var i=function(){this._events={}};i.prototype.emitter=function(t,e){if(this._events&&this._events[t]){var n=0,i=this._events[t],o=i.length;for(n;o>n;n++)try{i[n].apply(this,e)}catch(r){console.error(r)}return this}},i.prototype.register=function(t,e){return"function"!=typeof e?void console.error.call(this,"Callback is not a function!"):(this._events[t]||(this._events[t]=[]),this._events[t].push(e),this)},i.prototype.cancellation=function(t,e){if(this._events&&this._events[t]){var n=0,i=this._events[t],o=i.length;for(n;o>n;n++)if(i[n]===e)return i.splice(n,1),this;return this}},i.prototype.on=i.prototype.register,i.prototype.off=i.prototype.cancellation,n.exports=i});
;/*!/lib/dialog/dialog.js*/
define("order:lib/dialog/dialog",function(t,i,s){var e=t("common:lib/jquery/jquery-1.11.3"),n=t("order:lib/eventEmitter/eventEmitter"),o=function(){return n.apply(this,arguments),this.init.apply(this,arguments)};o.prototype=new n,o.prototype.constructor=o,o.prototype.html={mask:'<div class="mask" />',dialog:['<div class="main">','<div class="title"></div>','<div class="content"></div>','<div class="btns"></div>','<div class="close"></div>',"</div>"].join(""),goBackBtn:'<div class="btn back">返回上一步</div>',successBtn:'<div class="btn success">确定</div>',cancleBtn:'<div class="btn cancel">取消</div>'},o.prototype.init=function(t){return t?(this.$dialog=e(this.html.dialog),this.setContent(t.content,t.title),this.$dialog.find(".btns").html(this.html.successBtn+(t.isAlert?"":this.html.cancleBtn)),this.mask=e(this.html.mask).html(this.$dialog),this._bind(),this):void 0},o.prototype.setBtn=function(t){var i;switch(t){case"alert":i=this.html.successBtn;break;case"dialog":i=this.html.successBtn+this.html.cancleBtn;break;case"back":i=this.html.goBackBtn}return this.$dialog.find(".btns").html(i),this},o.prototype.setContent=function(t,i){return i&&e(".title",this.$dialog).html(i),t&&e(".content",this.$dialog).html(t),this},o.prototype._bind=function(){var t=this;this.$dialog.on("click",".success",function(i){t.emitter("success",[i,t]),t.hide()}),this.$dialog.on("click",".cancel, .close",function(i){t.emitter("cancel",[i,t]),t.hide()}),this.$dialog.on("click",".back",function(i){t.emitter("back",[i,t]),t.hide()})},o.prototype.show=function(){var t=this;return this.setContent.apply(this,arguments),this.isBody?(this.mask.show(),e(window).on("keydown",function(i){27===i.keyCode&&(t.hide(),e(window).off("keydown",arguments.callee))})):(this.mask.appendTo("body"),this.isBody=!0),this.emitter("show",[this]),this},o.prototype.hide=function(){return this.mask.hide(),this.emitter("hide",[this]),this},o.prototype.destroy=function(){return this.mask.detach(),this.isBody=!1,this.emitter("destory",[this]),this},s.exports=o});
;/*!/lib/selectmenu/selectmenu.js*/
define("order:lib/selectmenu/selectmenu",function(t,e,i){var s=t("common:lib/jquery/jquery-1.11.3"),n=t("order:lib/eventEmitter/eventEmitter");t("order:lib/prototype/function.bind");var o=function(){return n.apply(this,arguments),this.init.apply(this,arguments)};o.prototype=new n,o.prototype.constructor=o,o.prototype.defaultOptions={placeholder:"",select:"",text:"",value:"",name:"",listTextKey:"",listValueKey:"",data:null},o.prototype.init=function(t){return this.options=t=s.extend({},this.defaultOptions,t),this.$element=s(t.selector).addClass("mz-selectmenu"),this.$show=s('<input type="text" readonly="readonly" tabindex="-1" />').appendTo(this.$element).attr("placeholder",t.placeholder).val(t.text),this.$value=s('<input type="hidden" tabindex="-1" />').appendTo(this.$element).val(t.value).attr("name",t.name),this.$downmenu=s('<div class="mz-downmenu" />').appendTo("body"),this.value=t.value,this.text=t.text,this.setDownmenu(t.data),this.bind(),this},o.prototype.bind=function(){var t=this;this.$show.on("click",function(){t.emitter("click",arguments),t._setPosition(),t.$downmenu.slideDown(50),t.emitter("show",arguments)}),this.$show.on("blur",function(){t.beforeClose=setTimeout(function(){t.$downmenu.slideUp(50),t.emitter("blur",arguments)},200)}),this.$downmenu.on("scroll",function(){clearTimeout(t.beforeClose)})},o.prototype._setPosition=function(){var t=this.$element.offset();this.$downmenu.css({top:t.top+this.$element.height(),left:t.left,width:this.$element.outerWidth()-2})},o.prototype.setData=function(t,e){if(void 0==t&&void 0==e)return this;if(void 0==t&&e){if(!this.listObject)return this;s.each(this.listObject,function(i,s){var n=this.options.listValueKey?s[this.options.listValueKey]:s;n==e&&(t=this.options.listTextKey?s[this.options.listTextKey]:i)}.bind(this))}else if(void 0==e&&t){if(!this.listObject)return this;s.each(this.listObject,function(i,s){var n=this.options.listTextKey?s[this.options.listTextKey]:i;n==t&&(e=this.options.listValueKey?s[this.options.listValueKey]:s)}.bind(this))}return this.$show.val(t),this.$value.val(e),this.value=e,this.text=t,this},o.prototype.setDownmenu=function(t){if(t){var e=this;return this.listObject=t,this.$ul=s("<ul />"),s.each(t,function(t,i){var n=this;this._text=e.options.listTextKey?this[e.options.listTextKey]:t,this._value=e.options.listValueKey?this[e.options.listValueKey]:i,s("<li />").appendTo(e.$ul).text(this._text).on("click",function(){e.emitter("select",[n._text,n._value,e.text,e.value]),n._text!=e.text&&(e.$show.val(n._text),e.$value.val(n._value),e.value=n._value,e.text=n._text,e.emitter("change",[n._text,n._value,e.text,e.value])),e.$downmenu.slideUp(50)})}),this.$downmenu.html(this.$ul),this}},o.prototype.clear=function(){return this.$value.val(""),this.$show.val(""),this.$downmenu.empty(),this.value="",this.text="",delete this.$ul,this},i.exports=o});
;/*!/lib/citys/citys.js*/
define("order:lib/citys/citys",function(t,e,i){t("order:lib/prototype/function.bind");var a=t("common:lib/jquery/jquery-1.11.3"),n=t("order:lib/eventEmitter/eventEmitter"),o=t("order:lib/selectmenu/selectmenu"),s=function(){return n.apply(this,arguments),this.data={province:{id:"",text:"",zipCode:""},city:{id:"",text:"",zipCode:""},area:{id:"",text:"",zipCode:""},street:{id:"",text:"",zipCode:""},other:""},this.init.apply(this,arguments)};s.prototype=new n,s.prototype.constructor=s,s.prototype.levelArray=["province","city","area","street"],s.prototype.cityData={province:{index:0,data:{},json:{}},city:{index:1,data:{},json:{}},area:{index:2,data:{},json:{}},street:{index:3,data:{},json:{}}},s.prototype.defaultOptions={alert:function(t){alert(t)},listValueKey:"code",listTextKey:"name",selector:"",isShowOhterInput:!1,province:{placeholder:"省/直辖市",name:""},city:{placeholder:"城市",name:""},area:{placeholder:"区/县",name:""},street:{placeholder:"乡镇/街道",name:""},other:{maxlength:10,placeholder:"其他",name:""}},s.prototype.init=function(t){this.options=t=a.extend({},this.defaultOptions,t);var e=this,i="<div />";return this.DOMS={province:a(i),city:a(i),area:a(i),street:a(i)},this.$otherInput=a(i).addClass("mz-selectmenu other").append('<input type="text" placeholder="'+this.options.other.placeholder+'" maxlength="'+this.options.other.maxlength+'" />').hide(),this.$otherInput.children().attr("name",t.other.name),this.$element=a(t.selector).append(this.DOMS.province,this.DOMS.city,this.DOMS.area,this.DOMS.street,this.$otherInput).addClass("mz-citys"),a.each(this.DOMS,function(i){e.DOMS[i]=new o({selector:this,placeholder:e.options[i].placeholder,name:t[i].name,listValueKey:e.options.listValueKey,listTextKey:e.options.listTextKey}).on("change",e._handleChange.bind(e,i)).on("click",e._handleClick.bind(e,i))}),this.$otherInput.on("input propertychange","input",function(){e.data.other=a(this).val(),e.emitter("change",["other",e.data.other,null,e.getData()])}),this},s.prototype.clear=function(t){t=t||0;for(var e=t;e<this.levelArray.length;e++){var i=this.levelArray[e];this.DOMS[i].clear(),this.data[i]={id:"",text:"",zipCode:""}}return this.data.other="",this.$otherInput.hide().children().val(""),this},s.prototype.setData=function(t,e,i){if(e){var n=this;this._getData("province",0,function(e){this.DOMS.province.setDownmenu(e).setData(t.province.text),this.data.province={id:n.DOMS.province.value,text:n.DOMS.province.text,zipCode:""},this._handleChange("province",n.DOMS.province.text,n.DOMS.province.value),i()})}else a.each(t,function(t,e){"other"!=t&&this.DOMS[t].setData(e.text,e.id)}.bind(this)),this.data=a.extend(!0,{},this.data,t),0==this.data.street.id&&this.options.isShowOhterInput&&this.$otherInput.show().children().val(this.data.other),i();return this},s.prototype.getData=function(){return a.extend(!0,{},this.data)},s.prototype._handleClick=function(t){var e=Array.prototype.slice.call(arguments);e.push(this.getData()),this.emitter("click",e);var i=this.cityData[t].index,a=this.levelArray[i-1]||"province",n="province"==t?0:this.data[a].id;this.DOMS[t].$ul||!n&&0!=i||this._getData(t,n,function(e){this.DOMS[t].setDownmenu(e)})},s.prototype._extendCityJson=function(t,e){var i=this;a.each(e,function(e,a){i.cityData[t].json[a[i.options.listValueKey]]=a})},s.prototype._handleChange=function(t,e,i){var a=this.cityData[t].index;if(e&&(this.data[t].id=i,this.data[t].text=e,this.data[t].zipCode=this.cityData[t].json[i].zipCode||"",this.clear(a+1),this.emitter("change",[t,e,i,this.getData()])),a==this.levelArray.length-1)return void(0==i&&this.options.isShowOhterInput&&this.$otherInput.show());var n=this.levelArray[a+1];this._getData(n,i,function(t){this.DOMS[n].setDownmenu(t),1==t.length&&this.DOMS[n].setData(t[0][this.options.listTextKey],t[0][this.options.listValueKey])&&this._handleChange(n,t[0][this.options.listTextKey],t[0][this.options.listValueKey])})},s.prototype._getData=function(t,e,i){return e=e||0,this.cityData[t].data[e]?(i.call(this,this.cityData[t].data[e]),void this.emitter("data",[t,this.cityData[t].data[e]])):void a.ajax({url:"http://area.meizu.com/area/child/query/"+e,dataType:"jsonp",success:function(a){a.success?(this.cityData[t].data[e]=a.data,this._extendCityJson(t,a.data),i.call(this,a.data),this.emitter("data",[t,a.data])):this.options.alert(a.errorMsg)}.bind(this),error:function(){this.options.alert("服务器忙")}.bind(this)})},i.exports=s});
;/*!/lib/helper/modalApplier.js*/
define("order:lib/helper/modalApplier",function(e,r,n){var o=e("common:lib/jquery/jquery-1.11.3"),i=function(e,r){if(e&&r){var n;return o.each(e,function(e,o){("number"==typeof o||"string"==typeof o)&&(n=new RegExp("{{"+e+"}}","g"),r=r.replace(n,o+""))}),r}};n.exports=i});
;/*!/lib/prototype/date.format.js*/
define("order:lib/prototype/date.format",function(){Date.prototype.format||(Date.prototype.format=function(t){t=t||"yyyy-MM-dd hh:mm:ss";var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in e)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[s]:("00"+e[s]).substr((""+e[s]).length)));return t})});
;/*!/lib/countdown/countdown.js*/
define("order:lib/countdown/countdown",function(t,e,n){var o=t("order:lib/eventEmitter/eventEmitter"),i=function(){return o.apply(this,arguments),this.init.apply(this,arguments)};i.prototype=new o,i.prototype.constructor=i,i.prototype.defaultOptions={step:1,timeStep:1e3},i.prototype.init=function(t){return this.options=$.extend(!0,this.defaultOptions,t),this},i.prototype.count=function(t){var e=this;return this.counting=setTimeout(function(){var n=t-e.options.step;n>0?(e.emitter("count",[t,n]),e.count(n)):(e.emitter("count",[t,0]),e.emitter("end"))},this.options.timeStep),this},i.prototype.stop=function(){return clearTimeout(this.counting),this},n.exports=i});
;/*!/widget/csrf/csrf.js*/
define("order:widget/csrf/csrf",function(e,n,c){c.exports=function(e){$.ajax({url:"/independent",cache:!1,timeout:1e4,success:function(n,c,t){var r=t.getResponseHeader("X-CSRF-TOKEN");e&&e.call(e,r)}})}});
;/*!/widget/loading/loading.js*/
define("order:widget/loading/loading",function(i,n,o){var d=i("common:lib/jquery/jquery-1.11.3"),a=function(){var i='<div class="loading-mask"><div class="loading" /></div>',n=function(n){n=n||"body";var o=d(n).children(".loading-mask");0==o.length&&(o=d(i).appendTo(n),"body"==n&&o.css("position","fixed")),o.show()},o=function(i){i=i||"body",d(i).children(".loading-mask").hide()};return{show:n,hide:o}}();o.exports=a});
;/*!/widget/address/address.js*/
define("order:widget/address/address",function(e,s,d){e("order:lib/prototype/function.bind");var t={addressLength:0,activeAddressId:null,editingAddressId:null,$editingAddress:null,EventEmitter:e("order:lib/eventEmitter/eventEmitter"),Dialog:e("order:lib/dialog/dialog"),getCSRF:e("order:widget/csrf/csrf"),Loading:e("order:widget/loading/loading"),Citys:e("order:lib/citys/citys"),modalApplier:e("order:lib/helper/modalApplier"),$citys:$("#citys"),$addressList:$("#addressList"),$addressAdd:$("#addressAdd"),$addressOpenBtn:$("#addressOpenBtn"),$addressForm:$("#addressForm"),$addressFormName:$("#addressFormName"),$addressFormPhone:$("#addressFormPhone"),$addressFormDetail:$("#addressFormDetail"),$addressFormPrefix:$("#addressFormPrefix"),$addressFormCancel:$("#addressFormCancel"),$addressFormSave:$("#addressFormSave"),$addressModule:$("#addressModule"),$orderAddressHasOldTips:$("#orderAddressHasOldTips"),rules:{formName:/^[a-zA-Z|\d|\u0391-\uFFE5]*$/,formPhone:/^[1][34578][0-9]{9}$/,formDetail:/^[\u4E00-\u9FA5A-Za-z0-9_\-\,\，\.\。\(\)\（\）\s]+$/},citys:null,alert:null,event:null,addressTipsHtml:['<div class="order-address-checkbox-tips">','因配送地址库升级，提交订单前，请务必完善地址信息，让您享受更好的配送服务。<div class="order-address-checkbox-row"><i class="order-address-checkbox-perfect"></i></div>',"</div>"].join(""),addressCtrlHtml:['<div class="order-address-checkbox-ctrl">','<div class="order-address-checkbox-delete"></div>','<div class="order-address-checkbox-edit"></div>',"</div>"].join(""),addressHtml:['<li class="order-address-checkbox {{className}}">','<div class="order-address-checkbox-top">','<div class="order-address-checkbox-name" title="{{receiver}}">{{receiver}}</div>','<div class="order-address-checkbox-phone">{{telNumber}}</div>',"</div>",'<div class="order-address-checkbox-content">{{completeAddress}}</div>','<div class="order-address-checkbox-checked">','<div class="order-address-checkbox-tick"></div>',"</div>","{{ctrlHtml}}{{tipsHtml}}","</li>"].join(""),checkFormName:function(){var e=this.$addressFormName,s=$.trim(e.val()),d=e.parent().siblings(".order-address-row-tips");return s.length?this.rules.formName.test(s)?(d.empty(),s):(d.text("请输入正确的收件人姓名！"),!1):(d.text("请输入收件人姓名！"),!1)},checkFormPhone:function(){var e=this.$addressFormPhone,s=$.trim(e.val()),d=e.parent().siblings(".order-address-row-tips");return s.length?this.rules.formPhone.test(s)?(d.empty(),s):(d.text("请输入正确的手机号码！"),!1):(d.text("请输入手机号码！"),!1)},checkFormDetail:function(){var e=this.$addressFormDetail,s=$.trim(e.val()),d=e.parent().siblings(".order-address-row-tips");return s.length?this.rules.formDetail.test(s)?(d.empty(),s):(d.text("请输入正确的详细地址！"),!1):(d.text("请输入详细地址！"),!1)},checkFormCitys:function(){var e=this.citys.getData(),s=this.$citys,d=s.siblings(".order-address-row-tips");return e.province.id&&e.city.id&&e.area.id&&""!==e.street.id?(d.empty(),e):(d.text("请选择地址"),!1)},clearFormAndClose:function(){this.$addressForm.removeClass("open");var e=".order-address-row-tips";this.$addressFormName.val(""),this.$addressFormName.parent().siblings(e).empty(),this.$addressFormPhone.val(""),this.$addressFormPhone.parent().siblings(e).empty(),this.$addressFormDetail.val(""),this.$addressFormDetail.parent().siblings(e).empty(),this.citys.clear(),this.$addressFormPrefix.attr("data-prefix"," "),this.$citys.siblings(e).empty()},setAddress:function(e){var s;e.addressList.sort(function(s){return s.id===e.activeAddressId?-1:1}).sort(function(e,s){return e.isOld-s.isOld}),this.addressLength=e.addressList.length,this.activeAddressId=e.activeAddressId,e.useAppointAddr?(addresss.appointAddress.useAppointAddr=e.useAppointAddr,s=this.getAddressDom(addresss.appointAddress)):(s=$.map(e.addressList,this.getAddressDom.bind(this)),this.$addressAdd.show()),this.$addressList.append(s)},getAddressDom:function(e){var s=this;return e.isOld&&s.$orderAddressHasOldTips.css("display","inline-block"),e.tipsHtml=e.isOld?this.addressTipsHtml:"",e.ctrlHtml=e.useAppointAddr?"":this.addressCtrlHtml,e.className=e.id==this.activeAddressId?"checked":e.isOld?"disabled":"",$(this.modalApplier(e,this.addressHtml)).on("click",function(){$(this).hasClass("disabled")||$(this).hasClass("checked")||s.handleClickAddress.call(this,s,e)}).on("click",".order-address-checkbox-delete",this.handleDeleteAddress.bind(this,e)).on("click",".order-address-checkbox-edit,.order-address-checkbox-perfect",this.handleEditAddress.bind(this,e))},handleClickAddress:function(e,s){$(this).addClass("checked").siblings().removeClass("checked"),e.activeAddressId=s.id,e.event.emitter("selectAddress",[$.extend({},s)])},handleDeleteAddress:function(e,s){var d=this,t=$(s.delegateTarget);return $.ajax({url:"/customer_address/remove_submit.html",type:"get",data:{id:e.id},dataType:"json",timeout:1e4,beforeSend:d.Loading.show.bind(d,d.$addressModule),success:function(s){200==s.code?(d.addressLength--,t.remove(),d.clearFormAndClose(),d.activeAddressId==e.id&&(d.activeAddressId=null)):d.alert.setContent(s.message).show(),d.Loading.hide(d.$addressModule)},error:function(){d.Loading.hide(d.$addressModule),d.alert.setContent("网络错误").show()}}),!1},scrollToAddress:function(e,s){var d=this,t=arguments;setTimeout(function(){s>e+10?($(window).scrollTop(e+10),t.callee.call(d,e+10,s)):$(window).scrollTop(s)})},handleEditAddress:function(e,s){return this.scrollToAddress($(window).scrollTop(),this.$addressOpenBtn.offset().top-10),this.$editingAddress=$(s.delegateTarget),this.editingAddressId=e.id,this.clearFormAndClose(),this.$addressFormName.val(e.receiver),this.$addressFormPhone.val(e.telNumber),this.$addressFormDetail.val(e.address),this.citys.setData({province:{id:e.provinceId,text:e.province},city:{id:e.cityId,text:e.city},area:{id:e.areaId,text:e.area},street:{id:e.townId,text:0==e.townId?"其他":e.town,zipCode:e.zipCode},other:0==e.townId?e.town:""},!!e.isOld,function(){var e=this.citys.getData();this.$addressFormPrefix.attr("data-prefix",e.province.text+e.city.text+e.area.text+(e.street.id?e.street.text:"")+e.other),this.$addressForm.addClass("open")}.bind(this)),!1},saveAddress:function(e,s,d,t){var r=this;if(this.addressLength>=10&&!this.editingAddressId)return void this.alert.setContent("最多不能超过10个地址").show();var i=d.province.text+d.city.text+(d.area.text==d.street.text||0==d.street.id?d.area.text:d.area.text+d.street.text)+d.other+t,a=d.street.zipCode||d.area.zipCode||d.city.zipCode||d.province.zipCode||0,o={provinceId:d.province.id,province:d.province.text,cityId:d.city.id,city:d.city.text,areaId:d.area.id,area:d.area.text,townId:d.street.id,town:0==d.street.id?d.other:d.street.text,zipCode:a,completeAddress:i,address:t,id:r.editingAddressId||0,receiver:e,telNumber:s};this.getCSRF(function(e){$.ajax({url:"/customer_address/modify_submit.html",type:"post",data:o,dataType:"json",headers:{"X-CSRF-TOKEN":e},timeout:1e4,beforeSend:r.Loading.show.bind(r,r.$addressModule),success:function(e){if(200==e.code){if(r.editingAddressId){var s=$(r.getAddressDom(o)).replaceAll(r.$editingAddress);r.handleClickAddress.call(s,r,o)}else r.addressLength++,o.id=e.data,$(r.getAddressDom(o)).appendTo(r.$addressList).click();r.clearFormAndClose(),r.$editingAddress=null,r.editingAddressId=null}else r.alert.setContent(e.message).show();r.Loading.hide(r.$addressModule)},error:function(){r.Loading.hide(r.$addressModule),r.alert.setContent("网络错误").show()}})})},bind:function(){var e=this;this.$addressOpenBtn.on("click",function(){e.$addressForm.hasClass("open")?(e.clearFormAndClose(),e.$editingAddress=null,e.editingAddressId=null):(e.scrollToAddress($(window).scrollTop(),e.$addressOpenBtn.offset().top-10),e.$addressForm.addClass("open"))}),this.citys.on("change",function(s,d,t,r){e.$addressFormPrefix.attr("data-prefix",r.province.text+r.city.text+r.area.text+(r.street.id?r.street.text:"")+r.other)}),this.$addressFormName.on("blur",this.checkFormName.bind(this)),this.$addressFormPhone.on("blur",this.checkFormPhone.bind(this)),this.$addressFormDetail.on("blur",this.checkFormDetail.bind(this)),this.$addressFormCancel.on("click",function(){e.clearFormAndClose(),e.$editingAddress=null,e.editingAddressId=null}),this.$addressFormSave.on("click",function(){var s=e.checkFormName();if(!s)return!1;var d=e.checkFormPhone();if(!d)return!1;var t=e.checkFormCitys();if(!t)return!1;var r=e.checkFormDetail();return r?void e.saveAddress(s,d,t,r):!1})},init:function(e){var s=this;this.citys=new this.Citys({selector:s.$citys,isShowOhterInput:!0}),this.alert=new this.Dialog({title:"提示",isAlert:!0}),this.event=new this.EventEmitter,this.setAddress(e),this.bind()}};d.exports=t});
;/*!/widget/red/red.js*/
define("order:widget/red/red",function(e,t,d){e("order:lib/prototype/function.bind"),e("order:lib/prototype/date.format");var r={modalApplier:e("order:lib/helper/modalApplier"),EventEmitter:e("order:lib/eventEmitter/eventEmitter"),hasRed:!1,$redBody:null,events:null,useRedPrice:0,useRedId:null,redDomList:{},$redBox:$('<ul class="order-discount-red-list clearfix" />'),redHtml:['<li class="order-discount-red-item">','<div class="order-discount-red-tick">','<div class="order-discount-red-top clearfix">','<div class="order-discount-red-price">{{quota}}</div>','<div class="order-discount-red-name" title="{{name}}红包">{{name}}红包</div>',"</div>",'<div class="order-discount-red-time">{{startDate}} - {{endDate}}</div>',"</div>",'<div class="order-discount-red-footer">','<div class="order-discount-red-checkbox"></div>',"</div>","</li>"].join(""),clearRed:function(){$.each(this.redDomList,function(){$(this).removeClass("checked")}),this.useRedId=null,this.useRedPrice=0,this.events.emitter(["updatePrice"])},getRedDom:function(e){var t=this;return e.startDate=new Date(e.start).format("yyyy.MM.dd hh:mm"),e.endDate=new Date(e.end).format("yyyy.MM.dd hh:mm"),this.redDomList[e.redEnvelopeAcquirementId]=$(this.modalApplier(e,this.redHtml)).on("click",function(){if($(this).hasClass("checked"))$(this).removeClass("checked"),t.useRedId=null,t.useRedPrice=0,t.events.emitter("updatePrice");else{var d=t.discount.checkSelectedPriceOver(e.quota,"red");d?t.events.emitter("error",["body","抵扣金额超过订单金额"]):($(this).addClass("checked").siblings(".checked").removeClass("checked"),t.useRedId=e.redEnvelopeAcquirementId,t.useRedPrice=e.quota,t.events.emitter("updatePrice"))}}),this.redDomList[e.redEnvelopeAcquirementId]},setRed:function(e){e.sort(function(e,t){return t.quota-e.quota});var t=$.map(e,this.getRedDom.bind(this));this.$redBox.append(t)},init:function(e,t,d){this.discount=e,t&&t.length&&(this.hasRed=!0,this.events=new this.EventEmitter,this.setRed(t),this.$redBody=d.addClass("order-discount-red").append(this.$redBox))}};d.exports=r});
;/*!/widget/coupon/coupon.js*/
define("order:widget/coupon/coupon",function(o,e,t){o("order:lib/prototype/function.bind"),o("order:lib/prototype/date.format");var n={modalApplier:o("order:lib/helper/modalApplier"),EventEmitter:o("order:lib/eventEmitter/eventEmitter"),$couponbody:null,events:null,discount:null,useCouponId:null,hasCoupon:!1,useCouponPrice:0,couponDomList:{},$couponBox:$('<ul class="order-discount-coupon-list clearfix" />'),coupnHtml:['<li class="order-discount-coupon-item">','<div class="order-discount-coupon-tick {{singleClassName}}">','<div class="order-discount-coupon-top clearfix">','<div class="order-discount-coupon-top-left">','<div class="order-discount-coupon-price">{{reductionQuota}}</div>','<div class="order-discount-coupon-type">{{couponTypeText}}</div>',"</div>",'<div class="order-discount-coupon-top-right">','<div class="order-discount-coupon-title" title="{{name}}优惠券">{{name}}优惠券</div>','<div class="order-discount-coupon-desc">满{{consumptionQuota}}可用</div>',"</div>","</div>",'<div class="order-discount-coupon-bottom">','<div class="order-discount-coupon-time">{{startDate}} - {{endDate}}</div>','<div class="clearfix">','<div class="order-discount-coupon-range-text" title="适用范围：{{itemDesc}}">适用范围：{{itemDesc}}</div>','<a class="order-discount-coupon-range-link">查看适用></a>',"</div>","</div>","</div>",'<div class="order-discount-coupon-footer">','<div class="order-discount-coupon-checkbox"></div>',"</div>","</li>"].join(""),clearCoupon:function(){$.each(this.couponDomList,function(){$(this).removeClass("checked")}),this.useCouponId=null,this.useCouponPrice=0,this.events.emitter("updatePrice")},getCouponDom:function(o){var e=this;return o.singleClassName=1==o.couponType?"single":"",o.couponTypeText=1==o.couponType?"单品券":"多品券",o.startDate=new Date(o.start).format("yyyy.MM.dd hh:mm"),o.endDate=new Date(o.end).format("yyyy.MM.dd hh:mm"),this.couponDomList[o.couponAcquirementId]=$(this.modalApplier(o,this.coupnHtml)).on("click",function(t){if($(t.target).hasClass("order-discount-coupon-range-link"))return window.open("http://lists.meizu.com/page/couponItems/"+o.couponId+".html","_blank"),!1;if($(this).hasClass("checked"))$(this).removeClass("checked"),e.useCouponId=null,e.useCouponPrice=0,e.events.emitter("updatePrice");else{var n=e.discount.checkSelectedPriceOver(o.reductionQuota,"coupon");n?e.events.emitter("error",["body","抵扣金额超过订单金额"]):($(this).addClass("checked").siblings(".checked").removeClass("checked"),e.useCouponId=o.couponAcquirementId,e.useCouponPrice=o.reductionQuota,e.events.emitter("updatePrice"))}}),this.couponDomList[o.couponAcquirementId]},sortCoupon:function(o,e){return e.reductionQuota-o.reductionQuota},setCoupon:function(o){var e=this,t=0,n=null,i=[],c=[];$.each(o,function(o,e){1==e.couponType?i.push(e):c.push(e)}),i.sort(this.sortCoupon),c.sort(this.sortCoupon),o=i.concat(c);var s=$.map(o,function(o){var i=e.discount.checkSelectedPriceOver(o.reductionQuota,"coupon");return!i&&o.reductionQuota>t&&(t=o.reductionQuota,n=o.couponAcquirementId),e.getCouponDom(o)});this.$couponBox.append(s),setTimeout(function(){n&&e.couponDomList[n].click()})},init:function(o,e,t){this.discount=o,e&&e.length&&(this.hasCoupon=!0,this.events=new this.EventEmitter,this.setCoupon(e),this.$couponbody=t.addClass("order-discount-coupon").html(this.$couponBox))}};t.exports=n});
;/*!/widget/repo/repo.js*/
define("order:widget/repo/repo",function(e,t,o){e("order:lib/prototype/function.bind");var r={Dialog:e("order:lib/dialog/dialog"),getCSRF:e("order:widget/csrf/csrf"),loading:e("order:widget/loading/loading"),modalApplier:e("order:lib/helper/modalApplier"),EventEmitter:e("order:lib/eventEmitter/eventEmitter"),repoReg:/^.{18}$/,isOpenEnterRepo:!1,alert:null,isInit:!1,events:null,discount:null,useRepoCount:0,useRepoPrice:0,selectedRepo:{userTicks:{},inputTicks:{}},repoDomList:{},$repoBody:null,$userRepoContent:null,$enterRepoContent:null,$repoEnterTitle:null,$repoTitleBox:null,$repoEnterBox:null,$repoEnterForm:null,repoTitleBoxHtml:'<div class="order-discout-repo-text" />',repoTitleHtml:'已选择<span class="order-discount-repo-selected-num">{{repoNum}}</span>张回购券（可多张叠加使用），总抵现<span class="order-discount-repo-selected-price">{{repoPrice}}</span>',repoListBox:'<ul class="order-discount-repo-list" />',repoEnterTitleHtml:'<span class="order-discount-repo-enter-title">点击输入回购券</span>',repoEnterBoxHtml:'<div class="order-discount-repo-enter-content" />',repoEnterFormHtml:['<div class="order-discount-repo-enter-row">','券号：<input type="text" class="order-discount-repo-enter-input">','密码：<input type="password" class="order-discount-repo-enter-input">','<div class="btn">确定</div>','<span class="order-discount-repo-tips"></span>',"</div>"].join(""),repoHTML:['<li class="order-discount-repo-checkbox">','<div class="order-discount-repo-checkbox-title"></div>','<div class="order-discount-repo-checkbox-price">{{price}}</div>','<div class="order-discount-repo-checkbox-sn">{{sn}}</div>','<div class="order-discount-repo-checkbox-checked"></div>',"</li>"].join(""),clearRepo:function(){$.each(this.repoDomList,function(){$(this).removeClass("checked")}),this.useRepoCount=0,this.useRepoPrice=0,this.selectedRepo={userTicks:{},inputTicks:{}},this.setRepoTitle(),this.events.emitter("updatePrice")},checkSelectedPrice:function(e,t,o){if(o.data("isSelected"))o.data("isSelected",!1),this.useRepoCount--,this.useRepoPrice=(100*this.useRepoPrice-100*t)/100,o.removeClass("checked"),this.selectedRepo=e;else{var r=this.discount.checkSelectedPriceOver(t);r?this.events.emitter("error",["body","抵扣金额超过订单金额"]):(o.data("isSelected",!0),this.useRepoCount++,this.useRepoPrice=(100*this.useRepoPrice+100*t)/100,o.addClass("checked"),this.selectedRepo=e)}this.setRepoTitle(this.useRepoCount,this.useRepoPrice),this.events.emitter("updatePrice")},getUserRepo:function(e,t){var o=this;$.ajax({url:"/order/get_tickets.html",beforeSend:o.loading.show(t),timeout:1e4,success:function(r){200==r.code?(o.isInit=!0,o.setUserRepo(r.data),e()):o.alert.setContent(data.message).show(),o.loading.hide(t)},error:function(){o.alert.setContent("网络错误").show()}})},setUserRepo:function(e){var t=this;if(!$.isEmptyObject(e)){var o=0,e=$.map(e,function(e,r){return o++,t.repoDomList[r]=$(t.modalApplier({price:e,sn:r.replace(r.substring(4,14),"****")},t.repoHTML)).on("click",function(){var o=$.extend(!0,{},t.selectedRepo);$(this).data("isSelected")?delete o.userTicks[r]:o.userTicks[r]=e,t.checkSelectedPrice(o,e,$(this))}),t.repoDomList[r]});this.$userRepoContent.append(e)}},setRepoTitle:function(){var e=this;this.$repoTitleBox.html(this.modalApplier({repoNum:e.useRepoCount,repoPrice:e.useRepoPrice.toFixed(2)},this.repoTitleHtml))},checkEnterRepo:function(e,t){var o=this;this.loading.show(this.$repoBody),this.getCSRF(function(r){$.ajax({url:"/orders/query_repo.html",type:"post",headers:{"X-CSRF-TOKEN":r},data:{tick:e,password:t},timeout:1e4,success:function(r){o.loading.hide(o.$repoBody),200==r.code?($("input[type=text]",o.$repoEnterForm).val(""),$("input[type=password]",o.$repoEnterForm).val(""),o.repoDomList[e]=$(o.modalApplier({price:r.data.tickPrice,sn:e.replace(e.substring(4,14),"****")},o.repoHTML)).on("click",function(){var i=$.extend(!0,{},o.selectedRepo);$(this).data("isSelected")?delete i.inputTicks[e]:i.inputTicks[e]=t,o.checkSelectedPrice(i,r.data.tickPrice,$(this))}).appendTo(o.$enterRepoContent)):o.events.emitter("error",["body",r.message])},error:function(){o.loading.hide(o.$repoBody),o.events.emitter("error",["body","网络错误"])}})})},bind:function(){var e=this;this.$repoEnterTitle.on("click",function(){e.isOpenEnterRepo?e.$repoEnterBox.stop(!1,!0).slideUp(400,function(){e.isOpenEnterRepo=!1}):e.$repoEnterBox.stop(!1,!0).slideDown(400,function(){e.isOpenEnterRepo=!0})}),this.$repoEnterForm.on("click",".btn",function(){var t=$("input[type=text]",e.$repoEnterForm).val(),o=$("input[type=password]",e.$repoEnterForm).val(),r=$(".order-discount-repo-tips",e.$repoEnterForm);if(e.repoReg.test(t)&&""!=$.trim(o)){if(e.repoDomList[t])return void e.events.emitter("error",["body","该券已添加，请勿重复添加！"]);r.empty(),e.checkEnterRepo(t,o,r)}else e.events.emitter("error",["body","请输入正确的卡号和密码！"])})},init:function(e,t){this.alert=new this.Dialog({title:"提示",isAlert:!0}),this.discount=e,this.$repoTitleBox=$(this.repoTitleBoxHtml),this.setRepoTitle(),this.$userRepoContent=$(this.repoListBox),this.$repoEnterTitle=$(this.repoEnterTitleHtml),this.$repoEnterForm=$(this.repoEnterFormHtml),this.$enterRepoContent=$(this.repoListBox),this.$repoEnterBox=$(this.repoEnterBoxHtml).append(this.$repoEnterForm,this.$enterRepoContent),this.$repoBody=t.addClass("order-discount-repo").append(this.$repoTitleBox,this.$userRepoContent,$("<p />").append(this.$repoEnterTitle),this.$repoEnterBox),this.events=new this.EventEmitter,this.bind()}};o.exports=r});
;/*!/widget/discount/discount.js*/
define("order:widget/discount/discount",function(t,o,i){var e={originPayPrice:0,$counponBox:null,$repoBox:null,$redBox:null,modalApplier:t("order:lib/helper/modalApplier"),getCSRF:t("order:widget/csrf/csrf"),red:t("order:widget/red/red"),coupon:t("order:widget/coupon/coupon"),repo:t("order:widget/repo/repo"),loading:t("order:widget/loading/loading"),$discount:$("#discount"),$discountList:$("#discountList"),$totalRedRow:$("#totalRedRow"),$totalRepoRow:$("#totalRepoRow"),$totalCouponRow:$("#totalCouponRow"),$totalPayPrice:$("#totalPayPrice"),priceClass:".order-discount-item-right",titleClass:".order-discount-item-title",headerClass:".order-discount-item-header",contentClass:".order-discount-item-content",accordionHtml:['<li class="order-discount-item">','<div class="order-discount-item-header">','<div class="order-discount-item-title"></div>','<div class="order-discount-item-right"></div>',"</div>",'<div class="order-discount-item-content"></div>',"</li>"].join(""),errorHtml:['<div class="order-discount-content-mask">','<div class="order-discount-content-tips">','<div class="order-discount-content-tips-header">无法选择</div>','<div class="order-discount-content-tips-content">{{msg}}</div>',"</div>","</div>"].join(""),getActionPayPrice:function(t){var o=100*this.originPayPrice,i=100*this.repo.useRepoPrice,e=100*this.coupon.useCouponPrice,s=100*this.red.useRedPrice,r=o-i-s-e;switch(t){case"repo":r+=i;break;case"coupon":r+=e;break;case"red":r+=s}return r/100},checkSelectedPriceOver:function(t,o){return!!((100*this.getActionPayPrice(o)-100*t)/100<=0)},setTotalPrice:function(){if(this.coupon.hasCoupon){var t=this.coupon.useCouponPrice>0?'<span class="order-discount-item-price">'+this.coupon.useCouponPrice.toFixed(2)+"</span>":"";this.coupon.useCouponPrice>0?this.$totalCouponRow.show():this.$totalCouponRow.hide(),$(this.priceClass,this.$counponBox).html(t),$(".order-total-price",this.$totalCouponRow).text(this.coupon.useCouponPrice.toFixed(2))}if(this.red.hasRed){var o=this.red.useRedPrice>0?'<span class="order-discount-item-price">'+this.red.useRedPrice.toFixed(2)+"</span>":"";this.red.useRedPrice>0?this.$totalRedRow.show():this.$totalRedRow.hide(),$(this.priceClass,this.$redBox).html(o),$(".order-total-price",this.$totalRedRow).text(this.red.useRedPrice.toFixed(2))}var i=this.repo.useRepoPrice>0?'<span class="order-discount-item-price">'+this.repo.useRepoPrice.toFixed(2)+"</span>":"";this.repo.useRepoPrice>0?this.$totalRepoRow.show():this.$totalRepoRow.hide(),$(this.priceClass,this.$repoBox).html(i),$(".order-total-price",this.$totalRepoRow).text(this.repo.useRepoPrice.toFixed(2)),this.$totalPayPrice.text(this.getActionPayPrice().toFixed(2))},showError:function(t,o){t=$(t);var i=$(this.modalApplier({msg:o},this.errorHtml)).css({display:"none"}).appendTo(t).fadeIn(400);setTimeout(function(){i.fadeOut(400)},2e3)},bind:function(){var t=this;this.$discountList.on("click",this.headerClass,function(){var o=$(this).parent(),i=o.data("type"),e=$(this).siblings(t.contentClass),s=o.hasClass("open"),r=function(t,o,i){var e=i.siblings(".open");e.children(t.contentClass).stop(!1,!0).slideUp(400,function(){e.removeClass("open")}),o.stop(!1,!0).slideDown(400),i.addClass("open")};s?e.stop(!1,!0).slideUp(400,function(){e.parent().removeClass("open")}):"repo"!=i||t.repo.isInit?r(t,e,o):!t.repo.getUserRepo(r.bind(t,t,e,o),t.$discount)}),this.repo.events.on("updatePrice",this.setTotalPrice.bind(this)),this.repo.events.on("error",this.showError.bind(this))},init:function(t,o,i){this.originPayPrice=t,this.$counponBox=$(this.accordionHtml).data("type","coupon"),this.coupon.init(this,o,$(this.contentClass,this.$counponBox)),this.coupon.hasCoupon&&($(this.titleClass,this.$counponBox).text("使用优惠券"),this.$counponBox.addClass("open").appendTo(this.$discountList),this.coupon.events.on("updatePrice",this.setTotalPrice.bind(this)),this.coupon.events.on("error",this.showError.bind(this))),this.$redBox=$(this.accordionHtml).data("type","red"),this.red.init(this,i,$(this.contentClass,this.$redBox)),this.red.hasRed&&($(this.titleClass,this.$redBox).text("使用红包"),this.$redBox.appendTo(this.$discountList),this.red.events.on("updatePrice",this.setTotalPrice.bind(this)),this.red.events.on("error",this.showError.bind(this))),this.$repoBox=$(this.accordionHtml).data("type","repo"),this.repo.init(this,$(this.contentClass,this.$repoBox)),$(this.titleClass,this.$repoBox).text("使用回购券"),this.$repoBox.appendTo(this.$discountList),this.bind()}};i.exports=e});
;/*!/widget/product/product.js*/
define("order:widget/product/product",function(e,t,r){e("order:lib/prototype/function.bind"),e("order:lib/prototype/date.format");var o={pointer:{},countEndProd:[],supportFastArrival:!1,Countdown:e("order:lib/countdown/countdown"),modalApplier:e("order:lib/helper/modalApplier"),$orderProductList:$("#orderProductList"),$einvoiceDetail:$("#einvoiceDetail"),tableHtml:'<table cellpadding="0" cellspacing="0" />',getTimeString:function(e){var t=parseInt(e/864e5),r=parseInt((e-864e5*t)/36e5),o=parseInt((e-864e5*t-36e5*r)/6e4),i=parseInt((e-864e5*t-36e5*r-6e4*o)/1e3);return t=t>0?10>t?"0"+t:t:"00",r=r>0?10>r?"0"+r:r:"00",o=o>0?10>o?"0"+o:o:"00",i=i>0?10>i?"0"+i:i:"00",t>0?t+"天"+r+":"+o+":"+i:r+":"+o+":"+i},getTheadHtml:function(e){return["<thead>","<tr>",'<th class="order-product-table-name">','<div class="order-product-supplier">','供应商：<span class="order-product-supplier-name">'+e+"</span>",'<div class="order-product-supplier-tips">由“'+e+"”负责发货，并提供售后服务</div>","</div>","</th>",'<th class="order-product-table-price">单价</th>','<th class="order-product-table-num">数量</th>','<th class="order-product-table-total">小计</th>','<th class="order-product-table-express">配送方式</th>',"</tr>","</thead>"].join("")},tfootHtml:["<tfoot>","<tr>",'<td colspan="5">','<div class="order-product-info">','<div class="order-product-remark">','<span class="order-product-remark-title">备注</span>','<textarea class="order-product-remark-input" placeholder="备注..." maxlength="45"></textarea>',"</div>","</div>",'<div class="order-product-total">','合计：<span class="order-product-price red"></span>',"</div>","</td>","</tr>","</tfoot>"].join(""),getTfootHtml:function(e,t,r){var o,i=$(this.tfootHtml);return e>1e4?(o=$(this.invoiceHtml),r.invoiceType=0,r.invoiceTitle="个人",o.on("click",".order-product-invoice-radio",function(){var e=$(this).val(),t=$(this).parents(".order-product-invoice-type").siblings(".order-product-invoice-title");1==e?(r.invoiceType=1,t.show()):(r.invoiceType=0,t.hide())}).on("input propertychange",".order-product-invoice-input",function(){r.invoiceTitle=$(this).val()})):(o=$(this.einvoiceHtml),r.invoiceType=2),i.on("input propertychange",".order-product-remark-input",function(){r.remark=$(this).val()}),i.find(".order-product-remark").before(o),i.find(".order-product-price").text(t.toFixed(2)),i},tbodyHtml:"<tbody />",einvoiceHtml:['<div class="order-product-invoice clearfix">','<div class="order-product-invoice-type">发票类型：电子发票<div class="order-product-invoice-icon"></div></div>','<div class="order-product-invoice-title">发票抬头：默认为收货人姓名</div>',"</div>"].join(""),invoiceHtml:['<div class="order-product-invoice clearfix">','<div class="order-product-invoice-type">发票类型：','<label for="invoiceNo" class="order-product-invoice-label"><input class="order-product-invoice-radio" type="radio" name="invoice" value="0" id="invoiceNo" checked="checked">不开具发票</label>','<label for="invoiceYes" class="order-product-invoice-label"><input class="order-product-invoice-radio" type="radio" name="invoice" value="1" id="invoiceYes">纸质发票</label>',"</div>",'<div class="order-product-invoice-title paper">发票抬头：<input type="text" class="order-product-invoice-input" value="个人" maxlength="45"></div>',"</div>"].join(""),nameHtml:['<td class="order-product-table-name">','<img class="order-product-image" src="{{image}}"/>','<div  class="order-product-name">','<a target="_blank" class="order-product-link" href="{{itemUrl}}">{{name}}</a>',"</div>","</td>"].join(""),getNameDom:function(e,t){var r=t?e.name:e.itemName+"<br />"+e.cspuDesc+(e.packageId?'<br /><span class="order-product-group">'+e.packageName+"</span>":""),o=$(this.modalApplier({image:e.image,itemUrl:e.itemUrl,name:r},this.nameHtml));return t&&o.attr("colspan","4"),o},productHtml:"<tr />",getOtherDom:function(e,t){var r=this,o=$('<td class="order-product-table-price" />'),i=o.append("<p />");if(i.append('<span class="order-product-price">'+e.totalPrice.toFixed(2)+"</span>"),e.reduceMoney>0&&(i.append('<span class="order-product-price cancel">'+e.totalOriginPrice.toFixed(2)+"</span>"),e.reduceItems)){var d=$('<div class="order-product-discount" />'),a=$('<div class="order-product-discount-title" />').appendTo(d),n=null;if(e.reduceItems.length>1){d.addClass("more"),a.append('优惠 <span class="order-product-price sub">'+e.reduceMoney.toFixed(2)+'</span><i class="order-product-discount-triangle"></i>');var c=$('<ul class="order-product-discount-downmenu">').append($.map(e.reduceItems,function(e){return 1==e.type&&(n=e.endTime),'<li class="order-product-discount-item">'+(1==e.type?"限时折扣优惠":"套餐优惠")+' <span class="order-product-price sub">'+e.price.toFixed(2)+"</span></li>"}));d.append(c)}else 1==e.reduceItems.length&&(n=1==e.reduceItems[0].type?e.reduceItems[0].endTime:null,a.html((1==e.reduceItems[0].type?"限时折扣优惠":"套餐优惠")+' <span class="order-product-price sub">'+e.reduceItems[0].price.toFixed(2)+"</span>"));if(o.append(d),null!=n){t.countdown=new this.Countdown({step:1e3});var s=n-this.systemTime,p=$('<p class="order-product-countdown" />').text("限时特惠：剩余"+this.getTimeString(s));t.countdown.on("end",function(){r.countEndProd.push('"'+e.itemName+" "+e.cspuDesc+(e.packageId?" "+e.packageName:"")+'"')}).on("count",function(e){p.text("限时特惠：剩余"+r.getTimeString(e))}).count(s),o.append(p)}}var l=$('<td class="order-product-table-num">').text(e.number),u=$('<td class="order-product-table-total" />');return $('<p class="order-product-price red" />').text(e.payMoney.toFixed(2)).appendTo(u),t.number=e.number,t.skuId=e.skuId,e.packageId&&(t.packageId=e.packageId,t.packageList=$.map(e.skuInfoBoList,function(e){return e.skuId}).join(",")),[o,l,u]},expressHtml:['<td class="order-product-table-express">','<p>快递配送：运费<span class="order-product-price red"></span></p>',"</td>"].join(""),getExpressDom:function(e,t){var r=$(this.expressHtml);return r.find(".order-product-price").text(e.merchantExpressFee.toFixed(2)),e.supportFastArrival&&(this.supportFastArrival=!0,t.arrival=$(this.setArrival(e.fastArrival)),r.append(t.arrival)),r},setArrival:function(e){if(0!=e.fastArrivalStatus){var t=new Date(e.payDate).format("hh:mm");return this.modalApplier({text:1==e.fastArrivalStatus?"当日达":"次日达",beforeTime:"00:00"==t?"24:00":t,day:1==e.fastArrivalStatus?"今天":"明天",date:new Date(e.arrivalDate).format("MM月dd日")},this.arrivalHtml)}return'<div class="order-product-arrival" />'},arrivalHtml:['<div class="order-product-arrival">','<p><i class="order-product-arrival-icon"></i>{{text}}</p>',"<p>{{beforeTime}}前下单并支付，</p>","<p>预计<strong>{{day}}（{{date}}）</strong>送达</p>","</div>"].join(""),setProduct:function(e,t,r){var o,i=this,d=0;r.skus={};var a=$.map(e,function(e,a){r.skus[e.skuId]={};var n=$(i.productHtml);n.append(i.getNameDom(e),i.getOtherDom(e,r.skus[e.skuId])),0==a&&(o=$(i.getExpressDom(t,r)).appendTo(n));var c=[n].concat($.map(e.skuInfoBoList,function(e,t){var r=$(i.productHtml).addClass("order-product-table-child");return 0==t&&r.addClass("first"),r.append(i.getNameDom(e,!0)),d++,r}));return d++,c});return o.attr("rowspan",d),a},setMerchant:function(e){var t=this,r=$.map(e,function(e){t.pointer[e.merchantId]={};var r=$(t.tableHtml),o=$(t.getTheadHtml(e.merchantName)),i=$(t.tbodyHtml).append(t.setProduct(e.skuInfo,e,t.pointer[e.merchantId])),d=$(t.getTfootHtml(e.merchantId,e.merchantTotalMoney,t.pointer[e.merchantId]));return r.append(o,i,d)});this.$orderProductList.html(r)},bind:function(){var e=this;this.$einvoiceDetail.on("click",".einvoice-close",this.$einvoiceDetail.hide.bind(this.$einvoiceDetail,0)),this.$orderProductList.on("click",".order-product-invoice-icon",function(){e.$einvoiceDetail.show(),$(window).on("keydown",function(t){27===t.keyCode&&(e.$einvoiceDetail.hide(),$(window).off("keydown",arguments.callee))})})},init:function(e,t){this.systemTime=t,this.setMerchant(e),this.bind()}};r.exports=o});
;/*!/entry/add/add.js*/
require("order:lib/prototype/function.bind"),function(e){var t={address:require("order:widget/address/address"),discount:require("order:widget/discount/discount"),product:require("order:widget/product/product"),Dialog:require("order:lib/dialog/dialog"),getCSRF:require("order:widget/csrf/csrf"),Loading:require("order:widget/loading/loading"),$totalOrderPrice:$("#totalOrderPrice"),$totalDiscouuntPrice:$("#totalDiscouuntPrice"),$totalRepoPrice:$("#totalRepoPrice"),$totalExpressPrice:$("#totalExpressPrice"),$totalPayPrice:$("#totalPayPrice"),$validCode:$("#validCode"),$validInput:$("#validInput"),$submitForm:$("#submitForm"),validPrefix:"http://store-server.meizu.com/captcha/get",rules:{valid:/^.{4}$/},goBackTips:null,alert:null,setValidUrl:function(){var e=+new Date;this.$validCode.attr("src",this.validPrefix+"?"+this.data.verifyRule+"&"+e)},checkLimitedPreference:function(){return this.product.countEndProd.length?(this.goBackTips.setContent(this.product.countEndProd.join(",")+"的价格已发生变化，请重新下单！").show(),!1):this.address.activeAddressId?void this.checkValidCode():(this.alert.setContent("请选择收货人地址").show(),!1)},checkValidCode:function(){var e=this,t=this.$validInput.val();return this.rules.valid.test(t)?void $.ajax({url:"http://store-server.meizu.com/captcha/check?captcha="+t+"&sid="+e.data.verifySid,dataType:"jsonp",cache:!1,timeout:1e4,success:function(i){200==i.status?e.handleSetFormData(t):e.alert.setContent(i.error).show()},error:function(){e.alert.setContent("网络错误").show()}}):void this.alert.setContent("请输入四位验证码").show()},handleSetFormData:function(e){var t=this,i=!1,r=$.map(t.product.pointer,function(e){var t={invoiceType:e.invoiceType};return e.invoiceTitle&&(t.invoiceTitle=e.invoiceTitle),e.remark&&(t.remark=e.remark),t.orderItems=$.map(e.skus,function(e){e.countEnd&&(i=!0);var t={skuId:e.skuId,numbers:e.number};return e.packageId&&(t.packageId=e.packageId,t.packageList=e.packageList),t}),t}),a={mcode:t.data.mcode,sourceTime:t.data.sourceTime,validCode:e,addressId:t.address.activeAddressId,skillTicket:t.data.skillTicket,buyInfos:JSON.stringify(r)};this.discount.repo.useRepoCount>0&&(a.mcycleTickets=JSON.stringify(this.discount.repo.selectedRepo)),this.discount.coupon.useCouponId&&(a.couponAcquirementId=this.discount.coupon.useCouponId),this.discount.red.useRedId&&(a.redEnvelopeAcquirementId=this.discount.red.useRedId),this.handleSubmitForm(a)},handleSubmitForm:function(e){var t=this;this.getCSRF(function(i){$.ajax({url:"/order/submit.html",data:e,headers:{"X-CSRF-TOKEN":i},type:"post",timeout:1e4,beforeSend:t.Loading.show.bind(this,"body"),success:function(e){t.Loading.hide(),200==e.code?window.location.replace(e.data.url):e.code>6e3?(t.alert.setContent(e.message),t.alert.on("hide",function(){window.location.replace(e.data.url),t.alert.off("hide",arguments.callee)}),t.alert.show()):4e3==e.code?(t.alert.setContent(e.message),t.alert.on("hide",function(){switch(e.data.failCouponType){case 1:t.discount.repo.clearRepo();break;case 2:t.discount.coupon.clearCoupon();break;case 3:t.discount.red.clearRed()}t.alert.off("hide",arguments.callee)}),t.alert.show()):t.alert.setContent(e.message).show()},error:function(){t.Loading.hide(),t.alert.setContent("网络错误").show()}})})},setPrice:function(e){this.$totalOrderPrice.text(e.totalOrderMoney.toFixed(2)),this.$totalPayPrice.text(e.totalOrderPayMoney.toFixed(2)),this.$totalExpressPrice.text(e.totalExpressFee.toFixed(2))},bind:function(){this.address.event.on("selectAddress",this.handleCheckFastArrival.bind(this)),this.$validCode.on("click",this.setValidUrl.bind(this)),this.$submitForm.on("click",this.checkLimitedPreference.bind(this))},handleCheckFastArrival:function(e){if(this.product.supportFastArrival){var t=this,i=function(){$.each(t.product.pointer,function(e,i){i.arrival=$(t.product.setArrival({fastArrivalStatus:0})).replaceAll(i.arrival)})};this.getCSRF(function(r){$.ajax({url:"/order/check_fast_arrival",headers:{"X-CSRF-TOKEN":r},data:{skus:t.data.skus,provinceId:e.provinceId,cityId:e.cityId,areaId:e.areaId,townId:e.townId},type:"post",timeout:1e4,beforeSend:t.Loading.show.bind(this,t.address.$addressModule),success:function(e){200==e.code?$.each(e.data,function(i){t.product.pointer[i].arrival=$(t.product.setArrival(e.data[i])).replaceAll(t.product.pointer[i].arrival)}):i(),t.Loading.hide(t.address.$addressModule)},error:function(){i(),t.Loading.hide(t.address.$addressModule)}})})}},init:function(t){this.alert=new this.Dialog({title:"提示",isAlert:!0}),this.goBackTips=new this.Dialog({title:"提交失败"}).setBtn("back").on("hide",function(){e.location.replace(t.data.refererUrl)}),this.data=t.data,this.setPrice(this.data),this.setValidUrl(),this.product.init(this.data.buyInfoList,this.data.sysTime),this.address.init(this.data.address),this.discount.init(this.data.totalOrderPayMoney,this.data.discountCoupons,this.data.redCoupons),this.bind()}};t.init($.extend(!0,{},e.global))}(window);