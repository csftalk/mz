define("member:app/script/page/order-newPayment",function(require,exports,module){function loadDataList(){if(isSupportHistory()){category&&currentPage?loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback,currentPage):!category&&currentPage?loadObj(_dataFn(-1).allUrl,_dataFn(-1).tpl,callback,currentPage):category&&!currentPage?loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback):category||currentPage||loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback);for(var e=$(".type-tab-btn a"),a=Array.prototype.slice.call(e),n=0,t=a.length;t>n;n++)$(a[n]).attr("data-type")==category&&($(".type-tab-btn a").removeClass("active"),$(a[n]).addClass("active"))}else loadObj(_dataFn(category).allUrl,_dataFn(category).tpl,callback)}function isSupportHistory(){return!(!window.history||!history.pushState)}require("member:app/script/module/handlebars-helper-newPayment");var $=require("common:lib/jquery/jquery-1.11.3"),Cookie=require("member:app/script/module/cookie"),configUrl=require("member:app/script/module/config-url"),loadData=require("member:app/script/module/load-data"),parameter=require("member:app/script/module/href-parameter"),opreatFn=require("member:app/script/page/orderOpreat-newPayment"),ajaxAgency=require("member:app/script/module/isToken"),dailog=require("member:app/script/module/dialog"),Dailog=new dailog("alert"),DailogConfirm=new dailog("confirm"),category=parameter.get("type")||-1,currentPage=parameter.get("current")||1,userId=JSON.parse(decodeURIComponent(Cookie.getCookie("MEIZUSTORESESSIONVAL"))).uid,pageId=$("#pageId").val(),loadObj=function(e,a,n,t){new loadData({url:e,container:"#tableList",tpl:a,noListStr:"您暂无此类订单，赶快去下单吧！",sendData:{pageSize:6,current:t},dataEdit:!0,dataCallBack:dataCallBack,pageType:"default",tplFn:null,callback:n})},orderStatus=-1,orderSn,_dataFn=function(e){var a={allUrl:configUrl+"/vip/order/orders/"+userId+"/"+e,addressUrl:configUrl+"/vip/order/address/"+userId+"/"+orderSn,tpl:'<input id="unPayNum" type="hidden" value="{{data.unPayNum}}">\n<table class="orderItem">\n    {{#each data.resultList}}\n    {{#if old}}\n    <tr class="trHead">\n        <td colspan="5" class="title">\n            下单时间：<span class="time">{{transFormatDateAll createTime}}</span>订单号：<span class="orderNumber">{{orderSn}}</span>\n        </td>\n    </tr>\n    <tr class="list-box b-l b-r b-b">\n        <td class="list b-r">\n        {{#each childOrders}}\n            <div class="item clearfix">\n                {{{toSeeProductDetail ../old insuranceOrder itemNumber}}}\n                <img src="{{imgUrl}}"></a>\n                <div class="describe f-fl">\n                    <div class="vertic">\n                        <span class="clearfix">\n                            {{{toSeeProductDetail ../old insuranceOrder itemNumber}}}\n                            {{itemName}}</a>\n                            <i class="f-fr">￥{{price}} ×{{quantity}}</i>\n                        </span>\n                        {{#if insurance}}\n                        <span class="clearfix">\n                            <i class="f-fl nameWidth">{{insurance.name}}</i>\n                            <i class="f-fr">￥{{insurance.price}} ×{{insurance.num}}</i>\n                        </span>\n                        {{/if}}\n                    </div>\n                </div>\n                <div class="seeDeliverBox">\n                    {{{isInsuranceOrder insuranceOrder ../status ../old expressStatus ../../../data.date expressSignDate afterServiceStatus ../orderSn afterService refundType}}}\n                    {{!是否是老商品}}\n                    <input class="isOldProduct" type="hidden" value="{{../old}}">\n                    <input class="orderSn" type="hidden" value="{{../orderSn}}">\n                    <input class="orderSnSon" type="hidden" value="{{orderSn}}">\n                    <div class="content"></div>\n                </div> \n            </div>\n        {{/each}}\n        </td>  \n        <td class="b-r w125 center price">\n            <div class="priceDiv">\n                ￥ {{payPrice}}\n                {{{repoOrder repoMoney}}}\n                {{{mOrder type}}}\n            </div>\n        </td>  \n        <td class="b-r w125 center state">\n            <div class="stateDiv">\n                {{orderStatus status}}<br>{{isRefund inServiceStatus}}\n            </div>\n        </td> \n        <td class="w125 center opreat">\n            <ul>\n                {{!是否是老的商品}}\n                    <input class="_isOld" type="hidden" value="{{old}}">\n                {{!待付款}}\n                {{#equal status 0}}\n                    <li class="goPay">{{{goPay orderSn old}}}</li>\n                    <li class="cancel">取消订单</li>\n                {{/equal}}\n                {{!待发货}}\n                {{#equal status 1}}\n                    {{{applyFn inServiceStatus status}}}\n                {{/equal}}\n                {{!意外保订单}}\n                {{#equal status 9}}\n                    {{{applyFn inServiceStatus status}}}\n                {{/equal}}\n                {{!已付款}}\n                {{#equal status 11}}\n                    {{{applyFn inServiceStatus status}}}\n                {{/equal}}\n                <li class="more">{{{seeDetail orderSn old}}}</li>\n            </ul>\n        </td> \n    </tr>\n    <tr class="empty">\n        <td></td>\n    </tr>\n    {{else}}\n    <tr class="trHead">\n        <td colspan="5" class="title clearfix">\n            <div class="f-fl">下单时间：<span class="time">{{transFormatDateAll createTime}}</span>订单号：<span class="orderNumber">{{orderSn}}</span>\n            </div>\n            <!-- <span class="brand f-fr">\n                {{brandName}}\n                <i class="service">由“{{brandName}}”负责发货，并提供售后服务</i>\n                <i class="icon"></i>\n            </span> -->\n        </td>\n      </tr>\n    <tr class="list-box b-l b-r b-b">\n        <td class="list b-r">\n            {{#orderOptionLenth}}\n                {{#each childOrders}}\n                    {{#if isMainItem}}\n                        <div class="item clearfix">\n                            {{{toSeeProductDetail ../../../old ../insuranceOrder ../itemNumber}}}\n                            <img src="{{imgUrl}}" class="f-fl"></a>\n                            <div class="describe f-fl">\n                                <div class="vertic clearfix">\n                                    <span class="clearfix">\n                                        {{{toSeeProductDetail ../../../old ../insuranceOrder ../itemNumber}}}\n                                        {{itemName}} {{itemSkuDesc}} {{packageName}}</a>\n                                        <p>￥{{../../../salePrice}} ×{{quantity}}</p>\n                                        {{#isDiscount ../../../salePrice ../../../normalPrice}}\n                                            <p class="text-gray">￥{{../../../normalPrice}}</p>\n                                        {{/isDiscount}}\n                                    </span>\n                                </div>\n                            </div> \n                            <div class="seeDeliverBox">\n                                {{!是否是意外保订单以及显示是否签收文案}}\n                                {{{isInsuranceOrder ../insuranceOrder ../../../status ../../../old expressStatus ../expressSignDate ../expressConfirmTime}}}\n                                {{!是否是老商品}}\n                                <input class="isOldProduct" type="hidden" value="{{../../old}}">\n                                <input class="orderSn" type="hidden" value="{{../../orderSn}}">\n                                <input class="orderSnSon" type="hidden" value="{{orderSn}}">\n                                <div class="content"></div>\n                            </div>\n                            {{{serviceEnter expressStatus ../../../../../data.date ../expressSignDate ../../_flag ../../../orderSn ../afterService ../../__refundType ../expressConfirmTime ../../__refundSn ../../flag}}}\n                        </div>\n                    {{/if}}\n                {{/each}}\n            {{else}}\n                {{#each childOrders}}\n                    {{#if package}}\n                        <div class="item clearfix">\n                            {{{toSeeProductDetail ../../../old ../insuranceOrder ../itemNumber}}}\n                            <img src="{{imgUrl}}" class="f-fl"></a>\n                            <div class="describe f-fl">\n                                <div class="vertic clearfix">\n                                    <span class="clearfix">\n                                        {{{toSeeProductDetail ../../../old ../insuranceOrder ../itemNumber}}}\n                                        {{itemName}} {{itemSkuDesc}} {{packageName}}</a>\n                                        <p>￥{{../../../salePrice}} ×{{quantity}}</p>\n                                        {{#isDiscount ../../../salePrice ../../../normalPrice}}\n                                            <p class="text-gray">￥{{../../../normalPrice}}</p>\n                                        {{/isDiscount}}\n                                    </span>\n                                </div>\n                            </div> \n                            <div class="seeDeliverBox">\n                                {{!是否是意外保订单以及显示是否签收文案}}\n                                {{{isInsuranceOrder ../insuranceOrder ../../../status ../../../old expressStatus ../expressSignDate ../expressConfirmTime}}}\n                                {{!是否是老商品}}\n                                <input class="isOldProduct" type="hidden" value="{{../../old}}">\n                                <input class="orderSn" type="hidden" value="{{../../orderSn}}">\n                                <input class="orderSnSon" type="hidden" value="{{orderSn}}">\n                                <div class="content"></div>\n                            </div>\n                            {{{serviceEnter expressStatus ../../../../../data.date ../expressSignDate ../../_flag ../../../orderSn ../afterService ../../__refundType ../expressConfirmTime ../../__refundSn ../../flag}}}\n                        </div>\n                    {{else}}\n                        <div class="item clearfix">\n                            {{{toSeeProductDetail ../../old insuranceOrder itemNumber}}}\n                            <img src="{{imgUrl}}" class="f-fl"></a>\n                            <div class="describe f-fl">\n                                <div class="vertic clearfix">\n                                    <span class="clearfix">\n                                        {{{toSeeProductDetail ../../old insuranceOrder itemNumber}}}\n                                        {{itemName}} {{itemSkuDesc}} {{packageName}}</a>\n                                        <p>￥{{../../../salePrice}} ×{{quantity}}</p>\n                                        {{#isDiscount ../../../salePrice ../../../normalPrice}}\n                                            <p class="text-gray">￥{{../../../normalPrice}}</p>\n                                        {{/isDiscount}}\n                                    </span>\n                                    {{#if insurance}}\n                                    <span class="clearfix">\n                                        <i class="f-fl nameWidth">{{insurance.name}}</i>\n                                        <i class="f-fr">￥{{insurance.price}} ×{{insurance.num}}</i>\n                                    </span>\n                                    {{/if}}\n                                </div>\n                            </div> \n                            <div class="seeDeliverBox">\n                                {{!是否是意外保订单以及显示是否签收文案}}\n                                {{{isInsuranceOrder ../insuranceOrder ../../../status ../../../old expressStatus ../expressSignDate ../expressConfirmTime}}}\n                                {{!是否是老商品}}\n                                <input class="isOldProduct" type="hidden" value="{{../../old}}">\n                                <input class="orderSn" type="hidden" value="{{../../orderSn}}">\n                                <input class="orderSnSon" type="hidden" value="{{orderSn}}">\n                                <div class="content"></div>\n                            </div>\n                            {{{serviceEnter expressStatus ../../../../../data.date ../expressSignDate ../../_flag ../../../orderSn ../afterService ../../__refundType ../expressConfirmTime ../../__refundSn ../../flag}}}\n                        </div>\n                    {{/if}}\n                {{/each}}\n            {{/orderOptionLenth}}\n        </td>   \n        <td class="b-r w125 center price">  \n            <div class="priceDiv">\n                ￥ {{payPrice}}\n                {{{mOrder type}}}\n                {{#if huabei}}\n                    <span class="huabei j-huabei">花呗分期</span>\n                    <i class="hb-arr j-hb-item hide"></i>\n                    <p class="hb-describ j-hb-item hide">{{huabei}}</p>\n                {{/if}}\n            </div>\n        </td>  \n        <td class="b-r w125 center state">\n            <div class="stateDiv">\n                <div style="margin-bottom:5px">{{orderStatus status}}<br>{{isRefund inServiceStatus}}</div>\n                {{{fastArrive fastArriveStatus payTime arriveTime displayArriveInfo status}}}\n            </div>\n        </td> \n        <td class="w125 center opreat">\n            <ul>\n                {{!待付款}}\n                {{#equal status 0}}\n                    <li class="goPay">{{{goPay orderSn old}}}</li>\n                    <li class="cancel">取消订单</li>\n                {{/equal}}\n                {{!待发货}}\n                {{#equal status 1}}\n                    {{{applyFn inServiceStatus status}}}\n                {{/equal}}\n                {{!已发货}}\n                {{#equal status 2}}\n                    <li>{{{receiveFn childOrders}}}</li>\n                {{/equal}}\n                {{!意外保订单}}\n                {{#equal status 9}}\n                    {{{applyFn inServiceStatus status}}}\n                {{/equal}}\n                {{!已付款}}\n                {{#equal status 11}}\n                    {{{applyFn inServiceStatus status}}}\n                {{/equal}}\n                <li class="more">{{{seeDetail orderSn old}}}</li>\n            </ul>\n        </td> \n    </tr>\n    <tr class="empty">\n        <td></td>\n    </tr>\n    {{/if}}\n    {{/each}}\n</table>\n'};return a},dataCallBack=function(e){var a=e.data.resultList,n=e.data.unPayNum,t=0,r=0==n?"":n;if($("._actAmount").text(r),a&&!(a.length<=0)){for(var i=0,s=a.length;s>i;i++)for(var l=a[i].childOrders,d=l.length,c=null,o=null,u=null,p=null,m=0,v=d;v>m;m++){var f=l[m].afterService,S=(l[m].isMainItem,l[m].afterServiceStatus),b=l[m].refundSn,g=l[m].refundType;1==l[m].isMainItem&&4!=S?1==f?(u=S,p=g,c=S,o=b):t=0:1==l[m].isMainItem&&4==S?(p=g,c=S,o=b):1!=l[m].isMainItem&&4!=S?1==f&&null==u?(p=g,c=S,o=b):t=0:1!=l[m].isMainItem&&4==S&&null==c&&(p=g,c=S,o=b),f===!0&&t++,t>0&&(a[i].__refundType=p,a[i].__refundSn=o,a[i]._flag=c,a[i].flag=!0)}return e}},callback=function(){$(".brand").hover(function(){var e=$(this),a=e.find(".service"),n=e.find(".icon");a.show(),n.show();var t=(e.width(),n.width()),r=a.width(),i=r+t+25,s=t+4;a.css("margin-left","-"+i+"px"),n.css("margin-left","-"+s+"px")},function(){$(".service").hide(),$(".icon").hide()}),$(".j-huabei,.j-hb-item").hover(function(){$(this).parent().find(".j-hb-item").removeClass("hide")},function(){$(".j-hb-item").addClass("hide")}),$(".seeDeliverBox").hover(function(){var e=$(this),a=e.find(".isOldProduct").val(),n=1==a?e.find(".orderSn").val():e.find(".orderSnSon").val();opreatFn.seeDeliver(e,a,n,pageId,userId)},function(){$(".content").hide()}),$(".cancel").click(function(){var _this=$(this),isOld=eval(_this.parent().find("._isOld").val())===!0?1:0,orderSn=_this.parents(".list-box").find(".orderSn").val(),currentPage=parameter.get("current")||1;opreatFn.cancle(_this,isOld,orderSn,pageId,function(){orderStatus=$(".type-tab-btn").find(".active").attr("data-type"),loadObj(_dataFn(orderStatus).allUrl,_dataFn(orderStatus).tpl,callback,currentPage)})}),$(".apllyBack").click(function(){var _this=$(this),isOld=eval(_this.parent().find("._isOld").val())===!0?1:0,orderSn=_this.parents(".list-box").find(".orderSn").val(),currentPage=parameter.get("current")||1;opreatFn.apllyBack(_this,isOld,orderSn,pageId,function(){orderStatus=$(".type-tab-btn").find(".active").attr("data-type"),loadObj(_dataFn(orderStatus).allUrl,_dataFn(orderStatus).tpl,callback,currentPage)})}),$(".receive").click(function(){var e=$(this),a=e.parents(".list-box").find(".orderSn").val(),n=parameter.get("current")||1;opreatFn.receiveFn(a,pageId,function(){orderStatus=$(".type-tab-btn").find(".active").attr("data-type"),loadObj(_dataFn(orderStatus).allUrl,_dataFn(orderStatus).tpl,callback,n)})}),$(".oreadyGet").click(function(){var e=$(this),a=$(this).attr("data-parentStatus"),n=$(this).parent().parent().find(".describe").find(".productDetail").text(),t=e.parents(".list-box").find(".orderSn").val(),r=e.parent().find(".orderSnSon").val();opreatFn.isGet(e,a,n,t,pageId,r)})};loadDataList(),isSupportHistory()&&$(window).on("popstate",function(){category=parameter.get("type")||-1,currentPage=parameter.get("current")||1,loadDataList()}),$(".type-tab-btn a").click(function(){orderStatus=$(this).attr("data-type"),isSupportHistory()&&history.pushState({title:document.title},document.title,location.href.split("?")[0]+"?type="+orderStatus),$(this).addClass("active").siblings().removeClass("active"),loadObj(_dataFn(orderStatus).allUrl,_dataFn(orderStatus).tpl,callback)})});